{% extends 'layout.html' %}
{%  block head %}
    <title> Tracking Page </title>
{% endblock %}
{%  block body %}
<div class="row justify-content-center text-center">
	<div class="col-sm-6 col-xs-6">
  		<a href="/" class="btn btn-secondary" style="width: 20%; float: left;"> back </a>
  	</div>
</div>
<br><br>
<div class="row  items-center">
	<div class="card bg-light  mb-3" class="col-sm-6">
		<div class="card-header text-center">
			<h4>
				<span style="float: left"><b> ID: </b> {{user.id}}  </span>
				<b>  Name: </b> {{user.name}}
				<span style="float: right"><b> Phone: </b> 0{{user.phone}} </span>
			</h4>
		</div>
		<div class="card-body">
			<h4><b> Start Date: </b> {{start_date}} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
			<span style="float: right"><b> End Date: </b> {{end_date}} </span></h4>
		</div>
	</div>
</div>
<br>
{% for place in places %}
		<div class="row  items-center">
			<div class="card border-success bg-light mb-3" class="col-sm-6">
				<div class="card-header">
					<h4> {{place.date}} <span style="float: right;">Location</span></h4>
				</div>
				<div class="card-body">
				  <h4 class="card-title">Number of suspected contacts: 
				  	{% for key in contacts.keys() %}
			  			{% if key == place.id %}
			  				{{contacts[key]|length}}
			  			{% endif %}
					{% endfor %}
				  </h4>
				  <p class="card-text">
				  	<h5><ul>
				  	{% for key in contacts.keys() %}
			  			{% if key == place.id %}
			  				{% for i in range(contacts[key]|length) %}
				  				<li>
				  					<b> ID: </b>  {{contacts[key][i][4]}} &nbsp;&nbsp;&nbsp;&nbsp;
				  					<b> Name: </b>	 {{contacts[key][i][5]}} &nbsp;&nbsp;&nbsp;&nbsp;
				  					<b> Phone: </b>	 0{{contacts[key][i][6]}} 
				  				</li>
			  				{% endfor %}
			  			{% endif %}
					{% endfor %}
					</ul></h5>
				  </p>
				   	<form method="POST" action="{{url_for('map')}}">
						<div class="form-group row text-center">
							<div class="col-sm-12 col-xs-12">
								{% for key in contacts.keys() %}
								{% if key == place.id %}
								<input class="form-control" type="hidden"  name="length" value="{{contacts[key]|length}}">
								{% for i in range(contacts[key]|length) %}
									<input class="form-control" type="hidden"  name="cont{{i}}lat" value="{{contacts[key][i][1]}}">
									<input class="form-control" type="hidden"  name="cont{{i}}lng" value="{{contacts[key][i][2]}}">
									<input class="form-control" type="hidden"  name="cont{{i}}name" value="{{contacts[key][i][5]}}">
								{% endfor %}
								{% endif %}
								{% endfor %}
								<input class="form-control" type="hidden"  name="mlat" value="{{place.lat}}">
								<input class="form-control" type="hidden"  name="mlng" value="{{place.lng}}">
								<input class="form-control" type="hidden"  name="mname" value="{{user.name}}">
							    <input type="submit" class="btn btn-primary" formtarget="_blank" value=" Show on map " style="float: left" >
							</div>
						    
						</div>
				    </form>
				</div>
			</div>
		</div>
{% else %}
	<div class="row justify-content-center text-center">
		<div class="alert alert-success col-sm-6 col-xs-6">
	  		<h4> No contacts found! </h4>
	  	</div>
	</div>
{% endfor %}
{% endblock %}
{%  block js %} 
<script type="text/javascript">
	$('#exampleModal').on('show.bs.modal', function (event) {
	  var button = $(event.relatedTarget) // Button that triggered the modal
	  var recipient = button.data('whatever') // Extract info from data-* attributes
	  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
	  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
	  var modal = $(this)
	  modal.find('.modal-title').text('New message to ' + recipient)
	  modal.find('.modal-body input').val(recipient)
	})
</script>
{% endblock %}